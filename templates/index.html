<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Credit Risk Evaluation Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root {
  --bg: #080c18;
  --surface: #0f1624;
  --surface2: #161f30;
  --border: rgba(255,255,255,0.055);
  --c1: #00d4ff;
  --c2: #7c3aed;
  --c3: #10b981;
  --c4: #f59e0b;
  --c5: #ef4444;
  --c6: #ec4899;
  --c7: #14b8a6;
  --text: #eef2ff;
  --muted: #5d7499;
  --fh: 'Syne', sans-serif;
  --fb: 'DM Sans', sans-serif;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--fb);
  min-height: 100vh;
  overflow-x: hidden;
}

/* animated background */
body::before {
  content:'';
  position:fixed; inset:0;
  background:
    radial-gradient(ellipse 80% 50% at 20% 20%, rgba(0,212,255,0.04) 0%, transparent 60%),
    radial-gradient(ellipse 60% 40% at 80% 80%, rgba(124,58,237,0.05) 0%, transparent 60%),
    linear-gradient(rgba(0,212,255,0.018) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,212,255,0.018) 1px, transparent 1px);
  background-size: auto, auto, 44px 44px, 44px 44px;
  pointer-events:none; z-index:0;
}

.app { position:relative; z-index:1; display:flex; flex-direction:column; min-height:100vh; }

/* â”€â”€ HEADER â”€â”€ */
header {
  display:flex; align-items:center; justify-content:space-between;
  padding:0 32px; height:60px;
  border-bottom:1px solid var(--border);
  background:rgba(8,12,24,0.85);
  backdrop-filter:blur(16px);
  position:sticky; top:0; z-index:200;
}

.brand { display:flex; align-items:center; gap:12px; }
.brand-icon {
  width:34px; height:34px;
  background:linear-gradient(135deg,var(--c1),var(--c2));
  border-radius:9px;
  display:flex; align-items:center; justify-content:center;
  font-size:16px; flex-shrink:0;
  box-shadow:0 0 20px rgba(0,212,255,0.25);
}
.brand-name {
  font-family:var(--fh); font-size:14px; font-weight:700;
  letter-spacing:0.06em; text-transform:uppercase;
}
.brand-name em { color:var(--c1); font-style:normal; }

nav { display:flex; gap:2px; }
nav button {
  background:none; border:1px solid transparent;
  color:var(--muted); font-family:var(--fb); font-size:12.5px;
  font-weight:500; padding:6px 15px; border-radius:7px;
  cursor:pointer; transition:all .2s; letter-spacing:0.01em;
}
nav button:hover { color:var(--text); background:var(--surface2); }
nav button.active {
  color:var(--c1); border-color:rgba(0,212,255,0.25);
  background:rgba(0,212,255,0.07);
}

.header-meta { display:flex; align-items:center; gap:16px; }

.live-pill {
  display:flex; align-items:center; gap:6px;
  background:rgba(16,185,129,0.1); border:1px solid rgba(16,185,129,0.2);
  border-radius:20px; padding:4px 12px;
  font-size:11px; color:#10b981; font-weight:500;
}
.live-dot {
  width:6px; height:6px; background:#10b981;
  border-radius:50%; animation:blink 2s infinite;
}
@keyframes blink {
  0%,100%{opacity:1;transform:scale(1)}
  50%{opacity:0.4;transform:scale(1.5)}
}

.db-status { font-size:11px; color:var(--muted); }

/* â”€â”€ LOADER â”€â”€ */
#loader {
  position:fixed; inset:0; background:var(--bg);
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  z-index:999; transition:opacity .4s;
}
#loader.hidden { opacity:0; pointer-events:none; }
.loader-icon { font-size:40px; margin-bottom:16px; animation:spin 1.5s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }
.loader-text { font-family:var(--fh); font-size:14px; color:var(--muted); letter-spacing:0.1em; }

/* â”€â”€ MAIN â”€â”€ */
main { flex:1; padding:28px 32px 40px; }

/* â”€â”€ PAGE â”€â”€ */
.page { display:none; animation:fadeUp .35s ease; }
.page.active { display:block; }
@keyframes fadeUp {
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}

/* â”€â”€ SECTION LABEL â”€â”€ */
.slabel {
  font-family:var(--fh); font-size:10px; font-weight:700;
  letter-spacing:0.18em; text-transform:uppercase;
  color:var(--muted); margin-bottom:14px; margin-top:4px;
}

/* â”€â”€ KPI ROW â”€â”€ */
.kpi-row {
  display:grid; gap:12px; margin-bottom:24px;
}
.kpi-row.cols-6 { grid-template-columns:repeat(6,1fr); }
.kpi-row.cols-4 { grid-template-columns:repeat(4,1fr); }

.kpi {
  background:var(--surface); border:1px solid var(--border);
  border-radius:14px; padding:18px 18px 14px;
  position:relative; overflow:hidden;
  transition:transform .2s, border-color .2s;
  cursor:default;
}
.kpi:hover { transform:translateY(-2px); border-color:rgba(255,255,255,0.1); }
.kpi::before {
  content:''; position:absolute; top:0; left:0; right:0;
  height:2px; border-radius:14px 14px 0 0;
}
.kpi.a1::before { background:var(--c1); }
.kpi.a2::before { background:var(--c2); }
.kpi.a3::before { background:var(--c3); }
.kpi.a4::before { background:var(--c4); }
.kpi.a5::before { background:var(--c5); }
.kpi.a6::before { background:var(--c6); }
.kpi.a7::before { background:var(--c7); }
.kpi.a8::before { background:#6366f1; }

.kpi-icon { font-size:20px; margin-bottom:10px; }
.kpi-lbl { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:0.1em; margin-bottom:5px; }
.kpi-val { font-family:var(--fh); font-size:22px; font-weight:800; line-height:1; }
.kpi-sub { font-size:10px; color:var(--muted); margin-top:5px; }

/* â”€â”€ GRIDS â”€â”€ */
.g2 { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:14px; }
.g3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px; margin-bottom:14px; }
.g31 { display:grid; grid-template-columns:2fr 1fr; gap:14px; margin-bottom:14px; }
.g13 { display:grid; grid-template-columns:1fr 2fr; gap:14px; margin-bottom:14px; }
.g211 { display:grid; grid-template-columns:2fr 1fr 1fr; gap:14px; margin-bottom:14px; }

/* â”€â”€ CARD â”€â”€ */
.card {
  background:var(--surface); border:1px solid var(--border);
  border-radius:16px; padding:20px;
  transition:border-color .2s;
}
.card:hover { border-color:rgba(255,255,255,0.09); }

.card-head {
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:16px;
}
.card-title { font-family:var(--fh); font-size:12.5px; font-weight:700; letter-spacing:0.02em; }
.badge {
  font-size:10px; padding:3px 9px; border-radius:20px;
  background:rgba(0,212,255,0.09); color:var(--c1); font-weight:500;
}
.badge.green { background:rgba(16,185,129,0.09); color:var(--c3); }
.badge.amber { background:rgba(245,158,11,0.09); color:var(--c4); }

.cw { position:relative; }
.cw canvas { max-height:230px; }
.cw.tall canvas { max-height:290px; }
.cw.short canvas { max-height:170px; }

/* â”€â”€ DONUT CENTER â”€â”€ */
.dc {
  position:absolute; top:50%; left:50%;
  transform:translate(-50%,-55%);
  text-align:center; pointer-events:none;
}
.dc-big { font-family:var(--fh); font-size:20px; font-weight:800; }
.dc-sm { font-size:10px; color:var(--muted); }

/* â”€â”€ RISK BARS â”€â”€ */
.risk-bar-list { margin-top:6px; }
.rb-row { display:flex; align-items:center; gap:10px; margin-bottom:11px; }
.rb-lbl { font-size:11px; width:55px; flex-shrink:0; }
.rb-track { flex:1; height:5px; background:var(--surface2); border-radius:99px; overflow:hidden; }
.rb-fill { height:100%; border-radius:99px; transition:width 1.2s cubic-bezier(.4,0,.2,1); }
.rb-count { font-size:11px; font-family:var(--fh); font-weight:600; width:42px; text-align:right; }

/* â”€â”€ STAT ROWS â”€â”€ */
.stat-list { margin-top:4px; }
.sr {
  display:flex; justify-content:space-between; align-items:center;
  padding:10px 0; border-bottom:1px solid var(--border);
}
.sr:last-child { border-bottom:none; }
.sr-lbl { font-size:12px; color:var(--muted); }
.sr-val { font-family:var(--fh); font-size:13px; font-weight:700; }

/* â”€â”€ FOOTER â”€â”€ */
footer {
  border-top:1px solid var(--border);
  padding:12px 32px;
  font-size:11px; color:var(--muted);
  display:flex; justify-content:space-between; align-items:center;
}
.footer-left { display:flex; align-items:center; gap:8px; }

/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:1200px) {
  .kpi-row.cols-6 { grid-template-columns:repeat(3,1fr); }
  .g211 { grid-template-columns:1fr 1fr; }
  .g3 { grid-template-columns:1fr 1fr; }
}
</style>
</head>
<body>

<!-- LOADER -->
<div id="loader">
  <div class="loader-icon">âŸ³</div>
  <div class="loader-text">Connecting to MySQLâ€¦</div>
</div>

<div class="app">

  <!-- HEADER -->
  <header>
    <div class="brand">
      <div class="brand-icon">ğŸ¦</div>
      <div class="brand-name">Credit Risk <em>Evaluation</em></div>
    </div>

    <nav>
      <button class="active" onclick="showPage('home',this)">Home</button>
      <button onclick="showPage('loan',this)">Loan &amp; Deposit</button>
      <button onclick="showPage('deposit',this)">Deposit Analysis</button>
      <button onclick="showPage('summary',this)">Summary</button>
    </nav>

    <div class="header-meta">
      <div class="live-pill"><div class="live-dot"></div> Live MySQL</div>
      <div class="db-status" id="db-status">Loadingâ€¦</div>
    </div>
  </header>

  <!-- MAIN -->
  <main>

    <!-- â•â• PAGE: HOME â•â• -->
    <div class="page active" id="page-home">
      <div class="slabel">Overview Â· All Clients</div>

      <div class="kpi-row cols-6">
        <div class="kpi a1"><div class="kpi-icon">ğŸ‘¥</div><div class="kpi-lbl">Total Clients</div><div class="kpi-val" id="k-clients">â€”</div><div class="kpi-sub">Active accounts</div></div>
        <div class="kpi a2"><div class="kpi-icon">ğŸ’¸</div><div class="kpi-lbl">Total Loans</div><div class="kpi-val" id="k-loans">â€”</div><div class="kpi-sub">Bank loans issued</div></div>
        <div class="kpi a3"><div class="kpi-icon">ğŸ¦</div><div class="kpi-lbl">Total Deposits</div><div class="kpi-val" id="k-deposits">â€”</div><div class="kpi-sub">Deposits held</div></div>
        <div class="kpi a4"><div class="kpi-icon">ğŸ’³</div><div class="kpi-lbl">Checking Accts</div><div class="kpi-val" id="k-checking">â€”</div><div class="kpi-sub">Total balance</div></div>
        <div class="kpi a5"><div class="kpi-icon">ğŸ </div><div class="kpi-lbl">Saving Accts</div><div class="kpi-val" id="k-saving">â€”</div><div class="kpi-sub">Total balance</div></div>
        <div class="kpi a6"><div class="kpi-icon">ğŸ“Š</div><div class="kpi-lbl">Avg Income</div><div class="kpi-val" id="k-income">â€”</div><div class="kpi-sub">Per client</div></div>
      </div>

      <div class="g211">
        <div class="card">
          <div class="card-head"><div class="card-title">Clients by Nationality</div><div class="badge">5 regions</div></div>
          <div class="cw"><canvas id="c-nat"></canvas></div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Gender Split</div></div>
          <div class="cw" style="position:relative">
            <canvas id="c-gender"></canvas>
            <div class="dc"><div class="dc-big" id="dc-gender">â€”</div><div class="dc-sm">clients</div></div>
          </div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Loyalty Tier</div></div>
          <div class="cw" style="position:relative">
            <canvas id="c-loyalty"></canvas>
            <div class="dc"><div class="dc-big" id="dc-loyalty">â€”</div><div class="dc-sm">top tier</div></div>
          </div>
        </div>
      </div>

      <div class="g2">
        <div class="card">
          <div class="card-head"><div class="card-title">Risk Weighting Distribution</div><div class="badge amber">1â€“5 scale</div></div>
          <div class="risk-bar-list" id="risk-bars">
            <!-- injected by JS -->
          </div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Income Band Breakdown</div><div class="badge green">3 bands</div></div>
          <div class="cw short"><canvas id="c-income"></canvas></div>
        </div>
      </div>
    </div>

    <!-- â•â• PAGE: LOAN â•â• -->
    <div class="page" id="page-loan">
      <div class="slabel">Loan &amp; Lending Portfolio</div>

      <div class="kpi-row cols-4">
        <div class="kpi a1"><div class="kpi-icon">ğŸ’¸</div><div class="kpi-lbl">Total Loans</div><div class="kpi-val" id="kl-loans">â€”</div><div class="kpi-sub">All bank loans</div></div>
        <div class="kpi a3"><div class="kpi-icon">ğŸ’¼</div><div class="kpi-lbl">Business Lending</div><div class="kpi-val" id="kl-biz">â€”</div><div class="kpi-sub">Total portfolio</div></div>
        <div class="kpi a4"><div class="kpi-icon">ğŸ“Š</div><div class="kpi-lbl">Avg Risk Score</div><div class="kpi-val" id="kl-risk">â€”</div><div class="kpi-sub">Out of 5</div></div>
        <div class="kpi a5"><div class="kpi-icon">ğŸ‘¥</div><div class="kpi-lbl">Total Clients</div><div class="kpi-val" id="kl-clients">â€”</div><div class="kpi-sub">Active accounts</div></div>
      </div>

      <div class="g31">
        <div class="card">
          <div class="card-head"><div class="card-title">Bank Loans by Income Band</div><div class="badge">$M</div></div>
          <div class="cw tall"><canvas id="c-loan-income"></canvas></div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Fee Structure</div></div>
          <div class="cw" style="position:relative">
            <canvas id="c-fee"></canvas>
            <div class="dc"><div class="dc-big" id="dc-fee">â€”</div><div class="dc-sm">top tier</div></div>
          </div>
        </div>
      </div>

      <div class="g2">
        <div class="card">
          <div class="card-head"><div class="card-title">Bank Loans by Nationality</div><div class="badge">$M</div></div>
          <div class="cw"><canvas id="c-loan-nat"></canvas></div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Top Occupations by Loan Volume</div><div class="badge">$M</div></div>
          <div class="cw"><canvas id="c-loan-occ"></canvas></div>
        </div>
      </div>
    </div>

    <!-- â•â• PAGE: DEPOSIT â•â• -->
    <div class="page" id="page-deposit">
      <div class="slabel">Deposit &amp; Savings Analysis</div>

      <div class="kpi-row cols-4">
        <div class="kpi a3"><div class="kpi-icon">ğŸ¦</div><div class="kpi-lbl">Total Deposits</div><div class="kpi-val" id="kd-deposits">â€”</div><div class="kpi-sub">All bank deposits</div></div>
        <div class="kpi a1"><div class="kpi-icon">ğŸ’°</div><div class="kpi-lbl">Checking Accts</div><div class="kpi-val" id="kd-checking">â€”</div><div class="kpi-sub">Total balance</div></div>
        <div class="kpi a4"><div class="kpi-icon">ğŸ </div><div class="kpi-lbl">Saving Accts</div><div class="kpi-val" id="kd-saving">â€”</div><div class="kpi-sub">Total balance</div></div>
        <div class="kpi a6"><div class="kpi-icon">ğŸ“ˆ</div><div class="kpi-lbl">Avg Income</div><div class="kpi-val" id="kd-income">â€”</div><div class="kpi-sub">Per client</div></div>
      </div>

      <div class="g31">
        <div class="card">
          <div class="card-head"><div class="card-title">Bank Deposits by Income Band</div><div class="badge green">$M</div></div>
          <div class="cw tall"><canvas id="c-dep-income"></canvas></div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Deposits vs Savings Split</div></div>
          <div class="cw" style="position:relative">
            <canvas id="c-dep-split"></canvas>
            <div class="dc"><div class="dc-big">$M</div><div class="dc-sm">totals</div></div>
          </div>
        </div>
      </div>

      <div class="g2">
        <div class="card">
          <div class="card-head"><div class="card-title">Bank Deposits by Nationality</div><div class="badge">$M</div></div>
          <div class="cw"><canvas id="c-dep-nat"></canvas></div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Properties Owned Distribution</div><div class="badge amber">0â€“3</div></div>
          <div class="cw"><canvas id="c-prop"></canvas></div>
        </div>
      </div>
    </div>

    <!-- â•â• PAGE: SUMMARY â•â• -->
    <div class="page" id="page-summary">
      <div class="slabel">Full Portfolio Summary</div>

      <div class="g3">
        <div class="card">
          <div class="card-head"><div class="card-title">Portfolio Overview</div><div class="badge">$M</div></div>
          <div class="cw tall"><canvas id="c-sum-port"></canvas></div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Loans &amp; Deposits by Nationality</div><div class="badge">$M</div></div>
          <div class="cw tall"><canvas id="c-sum-nat"></canvas></div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Key Metrics</div><div class="badge green">Live</div></div>
          <div class="stat-list" id="stat-list">
            <!-- injected by JS -->
          </div>
        </div>
      </div>

      <div class="g2">
        <div class="card">
          <div class="card-head"><div class="card-title">Loans &amp; Deposits by Income Band</div><div class="badge">Grouped $M</div></div>
          <div class="cw tall"><canvas id="c-sum-income"></canvas></div>
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title">Risk Distribution Radar</div></div>
          <div class="cw tall"><canvas id="c-sum-radar"></canvas></div>
        </div>
      </div>
    </div>

  </main>

  <!-- FOOTER -->
  <footer>
    <div class="footer-left">
      ğŸ¦ Credit Risk Evaluation Dashboard
      <span style="color:var(--border)">|</span>
      Data Analytics &amp; Visualization Project
    </div>
    <div>MySQL Â· Flask Â· Chart.js Â· Live Data</div>
  </footer>

</div><!-- .app -->

<script>
// â”€â”€ GLOBALS â”€â”€
Chart.defaults.color = '#5d7499';
Chart.defaults.font.family = 'DM Sans';
Chart.defaults.plugins.legend.display = false;

const C = {
  c1:'#00d4ff', c2:'#7c3aed', c3:'#10b981',
  c4:'#f59e0b', c5:'#ef4444', c6:'#ec4899',
  c7:'#14b8a6', c8:'#6366f1'
};
const PAL = [C.c1,C.c2,C.c3,C.c4,C.c5,C.c6,C.c7,C.c8];

function a(hex, op){
  const r=parseInt(hex.slice(1,3),16),
        g=parseInt(hex.slice(3,5),16),
        b=parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${op})`;
}

const grid = {
  grid:{ color:'rgba(255,255,255,0.035)', drawBorder:false },
  ticks:{ color:'#5d7499', font:{size:11} }
};

// nav
function showPage(id, btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  btn.classList.add('active');
}

// format helpers
const fmt = (n,dec=1) => n>=1000 ? (n/1000).toFixed(dec)+'K' : n.toFixed(dec);
const fmtB = n => `$${n}B`;
const fmtM = n => `$${Math.round(n)}M`;

// chart store
const charts = {};
function mkChart(id, type, data, options){
  if(charts[id]) charts[id].destroy();
  charts[id] = new Chart(document.getElementById(id), {type, data, options});
}

// â”€â”€ FETCH & RENDER â”€â”€
async function load(){
  try {
    const res = await fetch('/api/data');
    const d = await res.json();

    // hide loader
    document.getElementById('loader').classList.add('hidden');
    document.getElementById('db-status').textContent =
      `${d.kpis.total_clients.toLocaleString()} clients Â· banking`;

    renderHome(d);
    renderLoan(d);
    renderDeposit(d);
    renderSummary(d);

  } catch(e) {
    document.querySelector('#loader .loader-text').textContent =
      'âŒ Cannot connect to MySQL. Check app.py credentials.';
    console.error(e);
  }
}

function renderHome(d){
  const k = d.kpis;

  // KPIs
  document.getElementById('k-clients').textContent  = k.total_clients.toLocaleString();
  document.getElementById('k-loans').textContent    = `$${k.total_loans_b}B`;
  document.getElementById('k-deposits').textContent = `$${k.total_deposits_b}B`;
  document.getElementById('k-checking').textContent = `$${k.total_checking_m}M`;
  document.getElementById('k-saving').textContent   = `$${k.total_saving_m}M`;
  document.getElementById('k-income').textContent   = `$${k.avg_income_k}K`;

  // Nationality bar
  mkChart('c-nat','bar',{
    labels: d.nationality.labels,
    datasets:[{
      data: d.nationality.values,
      backgroundColor: PAL,
      borderRadius:6, borderSkipped:false
    }]
  },{
    responsive:true,
    plugins:{tooltip:{callbacks:{label:c=>` ${c.raw.toLocaleString()} clients`}}},
    scales:{
      x:{...grid, grid:{display:false}},
      y:{...grid}
    }
  });

  // Gender donut
  document.getElementById('dc-gender').textContent = k.total_clients.toLocaleString();
  mkChart('c-gender','doughnut',{
    labels: d.gender.labels,
    datasets:[{
      data: d.gender.values,
      backgroundColor:[C.c1,C.c2],
      borderWidth:0, hoverOffset:6
    }]
  },{
    responsive:true, cutout:'74%',
    plugins:{
      legend:{display:true,position:'bottom',labels:{color:'#5d7499',boxWidth:9,padding:12,font:{size:11}}},
      tooltip:{callbacks:{label:c=>` ${c.raw} (${((c.raw/k.total_clients)*100).toFixed(1)}%)`}}
    }
  });

  // Loyalty donut
  const topLoy = d.loyalty.labels[0];
  const topLoyPct = Math.round((d.loyalty.values[0]/k.total_clients)*100)+'%';
  document.getElementById('dc-loyalty').textContent = topLoyPct;
  mkChart('c-loyalty','doughnut',{
    labels: d.loyalty.labels,
    datasets:[{
      data: d.loyalty.values,
      backgroundColor:[C.c1,C.c7,C.c4,C.c6],
      borderWidth:0, hoverOffset:6
    }]
  },{
    responsive:true, cutout:'74%',
    plugins:{
      legend:{display:true,position:'bottom',labels:{color:'#5d7499',boxWidth:9,padding:10,font:{size:11}}}
    }
  });

  // Risk bars
  const riskColors = [C.c3,C.c1,C.c4,C.c5,C.c2];
  const riskMax = Math.max(...d.risk.values);
  const rbEl = document.getElementById('risk-bars');
  rbEl.innerHTML = d.risk.labels.map((lbl,i)=>`
    <div class="rb-row">
      <div class="rb-lbl" style="color:${riskColors[i]}">${lbl}</div>
      <div class="rb-track"><div class="rb-fill" style="width:${(d.risk.values[i]/riskMax*100).toFixed(1)}%;background:${riskColors[i]}"></div></div>
      <div class="rb-count">${d.risk.values[i].toLocaleString()}</div>
    </div>
  `).join('');

  // Income Band horizontal bar
  mkChart('c-income','bar',{
    labels: d.income_band.labels,
    datasets:[{
      data: d.income_band.values,
      backgroundColor:[C.c4,C.c1,C.c3],
      borderRadius:7, borderSkipped:false
    }]
  },{
    responsive:true, indexAxis:'y',
    plugins:{tooltip:{callbacks:{label:c=>` ${c.raw.toLocaleString()} clients`}}},
    scales:{
      x:{...grid},
      y:{...grid, grid:{display:false}}
    }
  });
}

function renderLoan(d){
  const k = d.kpis;
  document.getElementById('kl-loans').textContent   = `$${k.total_loans_b}B`;
  document.getElementById('kl-biz').textContent     = `$${k.total_biz_b}B`;
  document.getElementById('kl-risk').textContent    = k.avg_risk;
  document.getElementById('kl-clients').textContent = k.total_clients.toLocaleString();

  // Loan by Income Band
  mkChart('c-loan-income','bar',{
    labels: d.loan_income.labels,
    datasets:[{
      data: d.loan_income.values,
      backgroundColor:[a(C.c4,0.8),a(C.c1,0.8),a(C.c3,0.8)],
      borderColor:[C.c4,C.c1,C.c3], borderWidth:1,
      borderRadius:9, borderSkipped:false
    }]
  },{
    responsive:true,
    plugins:{tooltip:{callbacks:{label:c=>` $${c.raw}M`}}},
    scales:{
      x:{...grid,grid:{display:false}},
      y:{...grid,ticks:{...grid.ticks,callback:v=>`$${v}M`}}
    }
  });

  // Fee donut
  document.getElementById('dc-fee').textContent = d.fee.labels[0];
  mkChart('c-fee','doughnut',{
    labels: d.fee.labels,
    datasets:[{
      data: d.fee.values,
      backgroundColor:[C.c1,C.c2,C.c4],
      borderWidth:0, hoverOffset:6
    }]
  },{
    responsive:true, cutout:'74%',
    plugins:{
      legend:{display:true,position:'bottom',labels:{color:'#5d7499',boxWidth:9,padding:12,font:{size:11}}}
    }
  });

  // Loans by Nationality
  mkChart('c-loan-nat','bar',{
    labels: d.loan_nat.labels,
    datasets:[{
      data: d.loan_nat.values,
      backgroundColor: PAL.map(c=>a(c,0.8)),
      borderColor: PAL, borderWidth:1,
      borderRadius:6, borderSkipped:false
    }]
  },{
    responsive:true,
    plugins:{tooltip:{callbacks:{label:c=>` $${c.raw}M`}}},
    scales:{
      x:{...grid,grid:{display:false}},
      y:{...grid,ticks:{...grid.ticks,callback:v=>`$${v}M`}}
    }
  });

  // Top Occupations
  mkChart('c-loan-occ','bar',{
    labels: d.occupations.labels,
    datasets:[{
      data: d.occupations.values,
      backgroundColor: a(C.c1,0.75),
      borderColor: C.c1, borderWidth:1,
      borderRadius:6, borderSkipped:false
    }]
  },{
    responsive:true, indexAxis:'y',
    plugins:{tooltip:{callbacks:{label:c=>` $${c.raw}M`}}},
    scales:{
      x:{...grid,ticks:{...grid.ticks,callback:v=>`$${v}M`}},
      y:{...grid,grid:{display:false},ticks:{...grid.ticks,font:{size:10}}}
    }
  });
}

function renderDeposit(d){
  const k = d.kpis;
  document.getElementById('kd-deposits').textContent = `$${k.total_deposits_b}B`;
  document.getElementById('kd-checking').textContent = `$${k.total_checking_m}M`;
  document.getElementById('kd-saving').textContent   = `$${k.total_saving_m}M`;
  document.getElementById('kd-income').textContent   = `$${k.avg_income_k}K`;

  // Dep by Income
  mkChart('c-dep-income','bar',{
    labels: d.dep_income.labels,
    datasets:[{
      data: d.dep_income.values,
      backgroundColor:[a(C.c3,0.8),a(C.c7,0.8),a(C.c1,0.8)],
      borderColor:[C.c3,C.c7,C.c1], borderWidth:1,
      borderRadius:9, borderSkipped:false
    }]
  },{
    responsive:true,
    plugins:{tooltip:{callbacks:{label:c=>` $${c.raw}M`}}},
    scales:{
      x:{...grid,grid:{display:false}},
      y:{...grid,ticks:{...grid.ticks,callback:v=>`$${v}M`}}
    }
  });

  // Dep split donut
  mkChart('c-dep-split','doughnut',{
    labels:['Bank Deposits','Savings','Checking'],
    datasets:[{
      data:[k.total_deposits_b*1000, k.total_saving_m, k.total_checking_m],
      backgroundColor:[C.c3,C.c1,C.c2],
      borderWidth:0, hoverOffset:6
    }]
  },{
    responsive:true, cutout:'74%',
    plugins:{
      legend:{display:true,position:'bottom',labels:{color:'#5d7499',boxWidth:9,padding:10,font:{size:11}}}
    }
  });

  // Dep by Nationality
  mkChart('c-dep-nat','bar',{
    labels: d.dep_nat.labels,
    datasets:[{
      data: d.dep_nat.values,
      backgroundColor: PAL.map(c=>a(c,0.8)),
      borderColor: PAL, borderWidth:1,
      borderRadius:6, borderSkipped:false
    }]
  },{
    responsive:true,
    plugins:{tooltip:{callbacks:{label:c=>` $${c.raw}M`}}},
    scales:{
      x:{...grid,grid:{display:false}},
      y:{...grid,ticks:{...grid.ticks,callback:v=>`$${v}M`}}
    }
  });

  // Properties
  mkChart('c-prop','bar',{
    labels: d.properties.labels,
    datasets:[{
      data: d.properties.values,
      backgroundColor:[C.c5,C.c4,C.c1,C.c3],
      borderRadius:8, borderSkipped:false
    }]
  },{
    responsive:true,
    plugins:{tooltip:{callbacks:{label:c=>` ${c.raw.toLocaleString()} clients`}}},
    scales:{
      x:{...grid,grid:{display:false}},
      y:{...grid}
    }
  });
}

function renderSummary(d){
  const k = d.kpis;

  // Portfolio bar
  mkChart('c-sum-port','bar',{
    labels: d.portfolio.labels,
    datasets:[{
      data: d.portfolio.values,
      backgroundColor: PAL.map(c=>a(c,0.8)),
      borderColor: PAL, borderWidth:1,
      borderRadius:8, borderSkipped:false
    }]
  },{
    responsive:true,
    plugins:{tooltip:{callbacks:{label:c=>` $${c.raw}M`}}},
    scales:{
      x:{...grid,grid:{display:false}},
      y:{...grid,ticks:{...grid.ticks,callback:v=>`$${v}M`}}
    }
  });

  // Grouped Nat
  mkChart('c-sum-nat','bar',{
    labels: d.loan_nat.labels,
    datasets:[
      {
        label:'Loans',
        data: d.loan_nat.values,
        backgroundColor: a(C.c1,0.8), borderColor:C.c1, borderWidth:1,
        borderRadius:4, borderSkipped:false
      },
      {
        label:'Deposits',
        data: d.dep_nat.values,
        backgroundColor: a(C.c3,0.8), borderColor:C.c3, borderWidth:1,
        borderRadius:4, borderSkipped:false
      }
    ]
  },{
    responsive:true,
    plugins:{
      legend:{display:true,position:'bottom',labels:{color:'#5d7499',boxWidth:9,padding:14,font:{size:11}}},
      tooltip:{callbacks:{label:c=>` ${c.dataset.label}: $${c.raw}M`}}
    },
    scales:{
      x:{...grid,grid:{display:false}},
      y:{...grid,ticks:{...grid.ticks,callback:v=>`$${v}M`}}
    }
  });

  // Stat list
  const stats = [
    ['Total Loans',       `$${k.total_loans_b}B`,    C.c1],
    ['Total Deposits',    `$${k.total_deposits_b}B`,  C.c3],
    ['Business Lending',  `$${k.total_biz_b}B`,       C.c2],
    ['Checking Accounts', `$${k.total_checking_m}M`,  C.c4],
    ['Saving Accounts',   `$${k.total_saving_m}M`,    C.c6],
    ['Avg Risk Score',    `${k.avg_risk} / 5`,         C.c5],
    ['Avg Client Income', `$${k.avg_income_k}K`,       C.c7],
    ['Total Clients',     k.total_clients.toLocaleString(), '#fff'],
  ];
  document.getElementById('stat-list').innerHTML =
    stats.map(([l,v,col])=>`
      <div class="sr">
        <div class="sr-lbl">${l}</div>
        <div class="sr-val" style="color:${col}">${v}</div>
      </div>
    `).join('');

  // Grouped Income
  mkChart('c-sum-income','bar',{
    labels: d.loan_income.labels,
    datasets:[
      {
        label:'Loans',
        data: d.loan_income.values,
        backgroundColor: a(C.c1,0.8), borderColor:C.c1, borderWidth:1,
        borderRadius:4, borderSkipped:false
      },
      {
        label:'Deposits',
        data: d.dep_income.values,
        backgroundColor: a(C.c3,0.8), borderColor:C.c3, borderWidth:1,
        borderRadius:4, borderSkipped:false
      }
    ]
  },{
    responsive:true,
    plugins:{
      legend:{display:true,position:'bottom',labels:{color:'#5d7499',boxWidth:9,padding:14,font:{size:11}}},
      tooltip:{callbacks:{label:c=>` ${c.dataset.label}: $${c.raw}M`}}
    },
    scales:{
      x:{...grid,grid:{display:false}},
      y:{...grid,ticks:{...grid.ticks,callback:v=>`$${v}M`}}
    }
  });

  // Radar
  mkChart('c-sum-radar','radar',{
    labels: d.risk.labels,
    datasets:[{
      label:'Clients',
      data: d.risk.values,
      borderColor: C.c1,
      backgroundColor: a(C.c1,0.12),
      pointBackgroundColor: C.c1,
      borderWidth:2, pointRadius:4
    }]
  },{
    responsive:true,
    plugins:{ legend:{display:false} },
    scales:{
      r:{
        grid:{ color:'rgba(255,255,255,0.05)' },
        angleLines:{ color:'rgba(255,255,255,0.05)' },
        pointLabels:{ color:'#5d7499', font:{size:11} },
        ticks:{ color:'#5d7499', backdropColor:'transparent', font:{size:10} }
      }
    }
  });
}

// â”€â”€ INIT â”€â”€
load();
</script>
</body>
</html>
